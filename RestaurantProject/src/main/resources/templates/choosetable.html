<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" th:href="@{/assets/css/choosetable.css}"/>
    <link rel="icon" href="data:,">
    <title>Chọn bàn</title>
</head>
<body>
    <div class="choose-table">
        <div class = "left-content">
            <div class = "table-code"><b>TABLE CODE: B2</b></div>
            <div class = "choose-table-label">
                <label for="">CHỌN BÀN</label>
            </div>
            <div class = "pick-area">
                <div><b>Chọn khu vực</b>
                </div>
                <!-- <input class = "area-list" type="text" list="area"> -->
                <select id = "area" class = "area">
                
                </select>
            </div>
            <div class = "pick-table">
                <div><b>Chọn bàn</b></div>
                <!-- <input class = "table-list" type="text" list="table"> -->
                <select id = "table" class = "table">
                
                </select>
            </div>
            <div class = "button">
                <div class = "confirm-button">Xác nhận</div>
                <div class = "confirm-button" onclick="window.location.href='/homepage/homepage-user'">Thoát</div>
            </div>
        </div>
        <div class="right-content">
            <div class = "name-of-area"><b>KHU VỰC B</b></div>
            <div class = "table-screen">
                <div>
                    <div>B1</div>
                    <div class = "div-bottom">Bàn trống</div>
                </div>
                <div>
                    <div>B2</div>
                    <div class = "div-bottom">Bàn trống</div>
                </div>
                <div class = "ordered">
                    <div>B3</div>
                    <div class = "div-bottom">27'</div>
                </div>
                <div>
                    <div>B4</div>
                    <div class = "div-bottom">Bàn trống</div>
                </div>
                <div>
                    <div>B5</div>
                    <div class = "div-bottom">Bàn trống</div>
                </div>
                <div>
                    <div>B6</div>
                    <div class = "div-bottom">Bàn trống</div>
                </div>
                <div>
                    <div>B7</div>
                    <div class = "div-bottom">Bàn trống</div>
                </div>
            </div>
        </div>
    </div>
    <script>
	    document.addEventListener('DOMContentLoaded', function () {
	        // Lấy danh sách khu vực từ API
	        fetch('/choose-table')
	            .then(response => response.json())
	            .then(data => {
	                const areaSelect = document.getElementById('area');
	                data.forEach(area => {
	                    const option = document.createElement('option');
	                    option.value = area.area_id;
	                    option.textContent = area.area_name;
	                    areaSelect.appendChild(option);
	                });
	            })
	            .catch(error => console.error('Error fetching areas:', error));
	
	        // Khi người dùng chọn khu vực
	        document.getElementById('area').addEventListener('change', function () {
	            const areaId = this.value;
	
	            // Gọi API để lấy danh sách bàn
	            fetch(`/choose-table/tables-data/${areaId}`)
	                .then(response => response.json())
	                .then(data => {
	                    // Cập nhật danh sách bàn trong dropdown
	                    const tableSelect = document.getElementById('table');
	                    tableSelect.innerHTML = ''; // Xóa các option cũ
	                    data.forEach(table => {
	                        const option = document.createElement('option');
	                        option.value = table.table_id;
	                        option.textContent = table.table_id;
	                        tableSelect.appendChild(option);
	                    });
	
	                    // Cập nhật danh sách bàn trong right-content
	                    const tableScreen = document.querySelector('.table-screen');
	                    tableScreen.innerHTML = ''; // Xóa nội dung cũ
	                    data.forEach(table => {
	                        const div = document.createElement('div');
	                        div.innerHTML = `
	                            <div>${table.table_id}</div>
	                            <div class="div-bottom">${table.table_status ? 'Đang sử dụng' : 'Bàn trống'}</div>
	                        `;
	                        if (table.table_status) {
	                            div.classList.add('ordered'); // Đánh dấu bàn đang sử dụng
	                        }
	                        tableScreen.appendChild(div);
	                    });
	                })
	                .catch(error => console.error('Error fetching tables data:', error));
	        });
	        document.querySelector('.confirm-button').addEventListener('click', function () {
	            const selectedTable = document.getElementById('table').value;

	            if (selectedTable) {
	                // Gửi yêu cầu cập nhật trạng thái bàn
	                fetch('/choose-table/update-table-status', {
	                    method: 'POST',
	                    headers: { 'Content-Type': 'application/json' },
	                    body: JSON.stringify({
	                        tableId: selectedTable,
	                        isAvailable: true, // Cập nhật trạng thái bàn sang "đang sử dụng"
	                    }),
	                })
	                .then(response => response.json())
	                .then(data => {
	                    if (data.status === 200) {
	                        alert(data.description);
	                        window.location.href = '/homepage-user/menu'; // Chuyển hướng đến giao diện menu
	                    } else {
	                        alert('Error: ' + data.description);
	                    }
	                })
	                .catch(error => console.error('Error:', error));
	            } else {
	                alert('Please select a table before confirming!');
	            }
	        });
	    });
    </script>
</body>
</html>